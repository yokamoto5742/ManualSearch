# マニュアル検索アプリ

## 概要

このアプリケーションは、指定したディレクトリ内にあるPDF、TXT、MDファイル形式で保存された業務マニュアルなどから、特定のキーワードを高速で検索するためのデスクトップツールです。 検索結果はファイルごとに一覧表示され、該当箇所をハイライトした状態で直接ファイルを開くことができます。

大きな特徴として、**ファイルインデックス機能**を搭載しており、一度インデックスを作成すれば、二回目以降の検索が非常に高速になります。

## 主な機能

  * **多様なファイル形式に対応**: PDF、テキストファイル (.txt)、Markdown (.md) ファイルを横断的に検索できます。
  * **高度な検索オプション**:
      * 複数のキーワードを指定できます（カンマ区切り）。
      * **AND検索**: すべてのキーワードを含むページ/ファイルを検索します。
      * **OR検索**: いずれかのキーワードを含むページ/ファイルを検索します。
      * サブディレクトリ内のファイルも再帰的に検索対象に含めるかを選択できます。
  * **インデックスによる高速検索**:
      * 対象ディレクトリのファイル内容を予めインデックス化し、検索を高速化します。
      * インデックスはGUIから簡単に作成・更新・クリーンアップできます。
  * **わかりやすい検索結果**:
      * 検索結果をファイルごとに一覧表示し、一致した箇所（ページ番号や行番号）と前後の文脈を表示します。
      * キーワードを色付きでハイライト表示し、視覚的に確認しやすくします。
  * **ダイレクトファイルアクセス**:
      * 検索結果からワンクリックで該当ファイルを開くことができます。
      * PDFの場合は該当ページを、テキスト/Markdownファイルの場合はハイライトされたHTMLファイルをブラウザで表示します。

## インストール方法

1.  このリポジトリをクローンまたはダウンロードします。

2.  必要な依存ライブラリをインストールします。

    ```bash
    pip install -r requirements.txt
    ```

    主なライブラリは以下の通りです。

      * `PyQt5`: GUIフレームワーク
      * `PyMuPDF`: PDFファイルの読み込みとハイライト
      * `psutil`: プロセスの管理
      * `pyautogui`: GUI操作の自動化
      * `markdown`: MarkdownのHTML変換

## 使用方法

1.  `main.py` を実行してアプリケーションを起動します。

    ```bash
    python main.py
    ```

2.  **ディレクトリの選択**:

      * 検索対象のディレクトリをプルダウンメニューから選択するか、「追加」ボタンで新たに追加します。
      * 「サブフォルダを含む」にチェックを入れると、選択したディレクトリ以下のすべてのフォルダが検索対象になります。

3.  **検索の実行**:

      * 検索したいキーワードを入力します。複数のキーワードは `,` または `、` で区切ります。
      * 検索タイプ（AND検索 / OR検索）を選択します。
      * 「インデックス検索」にチェックを入れると、作成済みのインデックスを使って高速に検索します。
      * 「検索」ボタンをクリックして検索を開始します。

4.  **結果の確認とファイルを開く**:

      * 検索が完了すると、結果が一覧で表示されます。
      * リストの項目をクリックすると、画面下部に詳細な内容（前後の文脈）がハイライト付きで表示されます。
      * リストの項目をダブルクリックするか、「ファイルを開く」ボタンをクリックすると、該当ファイルを直接開きます。

## 設定

設定は `config.ini` ファイルに自動的に保存され、次回起動時に読み込まれます。

  * **ウィンドウ設定**: ウィンドウのサイズや位置が保存されます。
  * **ディレクトリ設定**: 追加したディレクトリのリストや、最後に使用したディレクトリが保存されます。
  * **インデックス設定**: インデックスファイルのパスや、インデックス検索をデフォルトで使用するかの設定が保存されます。
  * **PDF設定**: Adobe Acrobatのパスや、ハイライトPDFの一時ファイルのクリーンアップ設定などが含まれます。

**注意**: PDFファイルを開くには、Adobe Acrobat Reader が `config.ini` に記載されたパスにインストールされている必要があります。

## 開発者向け情報

### ビルド方法

`PyInstaller` を使用して、実行可能ファイルをビルドできます。 `build.py` スクリプトを実行してください。

```bash
python build.py
```

ビルドすると、`dist` ディレクトリに `ManualSearch` という名前の実行可能ファイルが生成されます。

### テスト

`pytest` を使用したユニットテストが `tests` ディレクトリに用意されています。

すべてのテストを実行するには、`tests/test_runner.py` を実行します。

```bash
python tests/test_runner.py
```

カバレッジレポートも同時に生成され、`htmlcov` ディレクトリに出力されます。

## ライセンス

このプロジェクトは **GNU General Public License v3.0** の下で公開されています。
詳細は `docs/LICENSE` ファイルを確認してください。